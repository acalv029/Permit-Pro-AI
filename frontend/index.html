<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PermitPro AI - South Florida Permit Checker</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'outfit': ['Outfit', 'sans-serif'], 'mono': ['JetBrains Mono', 'monospace'] },
                    colors: { 'midnight': '#0a0a0f', 'obsidian': '#12121a', 'charcoal': '#1a1a24', 'electric': '#00f0ff', 'lime': '#c8ff00', 'coral': '#ff6b6b' }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Outfit', sans-serif; }
        body { background: #0a0a0f; }
        .hero-gradient { background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,240,255,0.15), transparent), radial-gradient(ellipse 60% 40% at 80% 50%, rgba(200,255,0,0.08), transparent), radial-gradient(ellipse 50% 30% at 20% 80%, rgba(0,240,255,0.1), transparent); }
        .grid-pattern { background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px); background-size: 60px 60px; }
        .glow-border { position: relative; background: linear-gradient(135deg, #1a1a24 0%, #12121a 100%); border: 1px solid rgba(0,240,255,0.2); }
        .glow-border::before { content: ''; position: absolute; inset: -1px; border-radius: inherit; padding: 1px; background: linear-gradient(135deg, rgba(0,240,255,0.4), transparent 50%, rgba(200,255,0,0.3)); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; }
        .scan-line { position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #00f0ff, transparent); animation: scan 3s ease-in-out infinite; opacity: 0.6; }
        @keyframes scan { 0%, 100% { transform: translateY(0); opacity: 0; } 10% { opacity: 0.6; } 90% { opacity: 0.6; } 100% { transform: translateY(100%); opacity: 0; } }
        .btn-primary { background: linear-gradient(135deg, #00f0ff 0%, #00c4d4 100%); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 30px rgba(0,240,255,0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 50px rgba(0,240,255,0.5), 0 10px 40px rgba(0,240,255,0.3); }
        .btn-secondary { background: transparent; border: 1px solid rgba(0,240,255,0.3); transition: all 0.3s ease; }
        .btn-secondary:hover { background: rgba(0,240,255,0.1); border-color: rgba(0,240,255,0.6); box-shadow: 0 0 30px rgba(0,240,255,0.2); }
        .drop-zone { border: 2px dashed rgba(0,240,255,0.3); transition: all 0.3s ease; background: rgba(0,240,255,0.02); }
        .drop-zone:hover, .drop-zone-active { border-color: #00f0ff; background: rgba(0,240,255,0.08); box-shadow: inset 0 0 60px rgba(0,240,255,0.1); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #12121a; }
        ::-webkit-scrollbar-thumb { background: #00f0ff40; border-radius: 3px; }
        select, input[type="text"], input[type="email"], input[type="password"] { background-image: none; }
        select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2300f0ff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 1rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeUp { animation: fadeUp 0.8s ease-out forwards; }
        .stagger-1 { animation-delay: 0.1s; opacity: 0; }
        .stagger-2 { animation-delay: 0.2s; opacity: 0; }
        .stagger-3 { animation-delay: 0.3s; opacity: 0; }
        .stagger-4 { animation-delay: 0.4s; opacity: 0; }
        .file-item { transition: all 0.2s ease; }
        .file-item:hover { background: rgba(0,240,255,0.05); }
        .progress-bar { background: linear-gradient(90deg, #00f0ff, #c8ff00); transition: width 0.3s ease-out; box-shadow: 0 0 20px rgba(0,240,255,0.5); }
        .status-ready { background: rgba(0,255,136,0.15); color: #00ff88; border: 1px solid rgba(0,255,136,0.3); }
        .status-attention { background: rgba(255,200,0,0.15); color: #ffc800; border: 1px solid rgba(255,200,0,0.3); }
        .status-incomplete { background: rgba(255,107,107,0.15); color: #ff6b6b; border: 1px solid rgba(255,107,107,0.3); }
        .history-row { transition: all 0.2s ease; }
        .history-row:hover { background: rgba(0,240,255,0.05); }
        .modal { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-midnight/80 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="showPage('home')">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-electric to-cyan-400 flex items-center justify-center">
                        <svg class="w-5 h-5 text-midnight" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="text-xl font-bold tracking-tight">PermitPro<span class="text-electric">AI</span></span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Logged out state -->
                    <div id="authButtons" class="flex items-center space-x-4">
                        <button onclick="showModal('login')" class="text-gray-400 hover:text-electric transition-colors text-sm font-medium">Log In</button>
                        <button onclick="showModal('register')" class="btn-primary px-4 py-2 rounded-lg text-midnight font-semibold text-sm">Sign Up</button>
                    </div>
                    <!-- Logged in state -->
                    <div id="userMenu" class="hidden flex items-center space-x-4">
                        <button onclick="showPage('history')" class="text-gray-400 hover:text-electric transition-colors text-sm font-medium">History</button>
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-full bg-electric/20 flex items-center justify-center">
                                <span id="userInitial" class="text-electric text-sm font-bold">U</span>
                            </div>
                            <span id="userEmail" class="text-sm text-gray-400 hidden md:block"></span>
                            <button onclick="logout()" class="text-gray-500 hover:text-coral transition-colors text-sm">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Modal -->
    <div id="loginModal" class="modal hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="modal-content glow-border rounded-2xl p-8 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Log In</h2>
                <button onclick="hideModal('login')" class="text-gray-500 hover:text-white">&times;</button>
            </div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-2">Email</label>
                    <input type="email" id="loginEmail" required class="w-full px-4 py-3 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none">
                </div>
                <div class="mb-6">
                    <label class="block text-sm text-gray-400 mb-2">Password</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-3 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none">
                </div>
                <div id="loginError" class="hidden mb-4 p-3 bg-coral/10 border border-coral/30 rounded-lg text-coral text-sm"></div>
                <button type="submit" class="btn-primary w-full py-3 rounded-xl text-midnight font-semibold">Log In</button>
            </form>
            <p class="text-center text-gray-500 text-sm mt-4">
                Don't have an account? <button onclick="hideModal('login'); showModal('register')" class="text-electric hover:underline">Sign up</button>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="modal-content glow-border rounded-2xl p-8 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Create Account</h2>
                <button onclick="hideModal('register')" class="text-gray-500 hover:text-white">&times;</button>
            </div>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-2">Email</label>
                    <input type="email" id="registerEmail" required class="w-full px-4 py-3 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-2">Password (min 8 characters)</label>
                    <input type="password" id="registerPassword" required minlength="8" class="w-full px-4 py-3 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none">
                </div>
                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-2">Full Name (optional)</label>
                    <input type="text" id="registerName" class="w-full px-4 py-3 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none">
                </div>
                <div class="mb-6">
                    <label class="block text-sm text-gray-400 mb-2">Company (optional)</label>
                    <input type="text" id="registerCompany" class="w-full px-4 py-3 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none">
                </div>
                <div id="registerError" class="hidden mb-4 p-3 bg-coral/10 border border-coral/30 rounded-lg text-coral text-sm"></div>
                <button type="submit" class="btn-primary w-full py-3 rounded-xl text-midnight font-semibold">Create Account</button>
            </form>
            <p class="text-center text-gray-500 text-sm mt-4">
                Already have an account? <button onclick="hideModal('register'); showModal('login')" class="text-electric hover:underline">Log in</button>
            </p>
        </div>
    </div>

    <!-- Home Page -->
    <div id="homePage">
        <!-- Hero Section -->
        <section class="relative min-h-screen hero-gradient grid-pattern flex items-center pt-20">
            <div class="max-w-7xl mx-auto px-6 lg:px-8 py-20">
                <div class="max-w-4xl">
                    <div class="animate-fadeUp stagger-1">
                        <div class="inline-flex items-center px-4 py-2 rounded-full bg-electric/10 border border-electric/30 text-electric text-sm font-medium mb-8">
                            <span class="w-2 h-2 bg-electric rounded-full mr-3 animate-pulse"></span>
                            AI-Powered Analysis
                        </div>
                    </div>
                    <h1 class="text-5xl sm:text-6xl lg:text-7xl font-bold leading-tight mb-6 animate-fadeUp stagger-2">
                        South Florida<br>
                        <span class="bg-gradient-to-r from-electric via-cyan-400 to-lime bg-clip-text text-transparent">Permit Checker</span>
                    </h1>
                    <p class="text-xl text-gray-400 mb-10 max-w-2xl leading-relaxed animate-fadeUp stagger-3">
                        Upload your complete permit package and get instant AI analysis against municipal requirements. Stop guessing, start knowing.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 animate-fadeUp stagger-4">
                        <a href="#analyzer" class="btn-primary px-8 py-4 rounded-xl text-midnight font-semibold text-center">Start Analysis</a>
                        <a href="#features" class="btn-secondary px-8 py-4 rounded-xl text-electric font-medium text-center">Learn More</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analyzer Section -->
        <section id="analyzer" class="py-24 px-6 lg:px-8 relative">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-bold mb-4">Analyze Your <span class="text-electric">Permit Package</span></h2>
                    <p class="text-gray-400 max-w-xl mx-auto">Select your city and permit type, then upload your documents for instant compliance analysis.</p>
                </div>
                <div class="glow-border rounded-3xl p-8 lg:p-10 relative overflow-hidden">
                    <div class="scan-line"></div>
                    
                    <!-- Step 1 -->
                    <div class="mb-10">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 rounded-xl bg-electric/20 text-electric flex items-center justify-center font-mono font-bold mr-4">01</div>
                            <h3 class="text-xl font-semibold">Location & Permit Type</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2 font-medium">City</label>
                                <select id="citySelect" class="w-full px-5 py-4 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none focus:ring-1 focus:ring-electric transition-all appearance-none cursor-pointer">
                                    <option value="">Select a city...</option>
                                    <option value="Fort Lauderdale">Fort Lauderdale</option>
                                    <option value="Pompano Beach">Pompano Beach</option>
                                    <option value="Hollywood">Hollywood</option>
                                    <option value="Coral Springs">Coral Springs</option>
                                    <option value="Boca Raton">Boca Raton</option>
                                    <option value="Lauderdale-by-the-Sea">Lauderdale-by-the-Sea</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2 font-medium">Permit Type</label>
                                <select id="permitSelect" class="w-full px-5 py-4 bg-charcoal border border-white/10 rounded-xl text-white focus:border-electric focus:outline-none focus:ring-1 focus:ring-electric transition-all appearance-none cursor-pointer">
                                    <option value="">Select permit type...</option>
                                    <option value="building">Building Permit</option>
                                    <option value="electrical">Electrical Permit</option>
                                    <option value="plumbing">Plumbing Permit</option>
                                    <option value="mechanical">Mechanical / HVAC</option>
                                    <option value="roofing">Roofing Permit</option>
                                    <option value="dock">Dock / Marine</option>
                                    <option value="seawall">Seawall Permit</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="mb-10">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 rounded-xl bg-electric/20 text-electric flex items-center justify-center font-mono font-bold mr-4">02</div>
                            <h3 class="text-xl font-semibold">Upload Permit Package</h3>
                        </div>
                        <div id="dropZone" class="drop-zone rounded-2xl p-10 text-center cursor-pointer relative">
                            <input type="file" id="folderInput" webkitdirectory directory multiple accept=".pdf,.png,.jpg,.jpeg" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            <div class="mb-6">
                                <div class="w-20 h-20 mx-auto rounded-2xl bg-electric/10 border border-electric/30 flex items-center justify-center mb-4">
                                    <svg class="w-10 h-10 text-electric" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-lg font-medium text-white mb-2">Drop your permit folder here</p>
                            <p class="text-gray-500 mb-6">or click to browse</p>
                            <button type="button" id="selectFolderBtn" class="px-6 py-3 bg-electric/20 hover:bg-electric/30 border border-electric/30 text-electric rounded-xl font-medium transition-all">Select Permit Folder</button>
                            <p class="text-xs text-gray-600 mt-6 font-mono">PDF, PNG, JPG • Max 50 files • Max 200MB</p>
                        </div>

                        <!-- File Preview -->
                        <div id="filePreview" class="hidden mt-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-white">Selected Files</h4>
                                <button id="clearFilesBtn" class="text-sm text-coral hover:text-red-400 font-medium transition-colors">Clear All</button>
                            </div>
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <div class="bg-charcoal rounded-xl p-4 text-center border border-white/5">
                                    <div id="fileCount" class="text-2xl font-bold text-electric font-mono">0</div>
                                    <div class="text-xs text-gray-500 mt-1">Files</div>
                                </div>
                                <div class="bg-charcoal rounded-xl p-4 text-center border border-white/5">
                                    <div id="totalSize" class="text-2xl font-bold text-electric font-mono">0 MB</div>
                                    <div class="text-xs text-gray-500 mt-1">Total Size</div>
                                </div>
                                <div class="bg-charcoal rounded-xl p-4 text-center border border-white/5">
                                    <div id="validCount" class="text-2xl font-bold text-lime font-mono">0</div>
                                    <div class="text-xs text-gray-500 mt-1">Valid</div>
                                </div>
                            </div>
                            <div id="sizeWarning" class="hidden mb-4 p-4 rounded-xl flex items-center"></div>
                            <div id="invalidFilesWarning" class="hidden mb-4 p-4 bg-coral/10 border border-coral/30 rounded-xl">
                                <div class="flex items-center text-coral font-medium mb-2">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                    Invalid Files
                                </div>
                                <ul id="invalidFilesList" class="text-sm text-coral/80 pl-7 list-disc"></ul>
                            </div>
                            <div class="max-h-56 overflow-y-auto rounded-xl border border-white/5 bg-obsidian">
                                <ul id="fileList" class="divide-y divide-white/5"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Analyze Button -->
                    <div class="text-center">
                        <button id="analyzeBtn" disabled class="btn-primary px-12 py-5 rounded-xl text-midnight font-bold text-lg disabled:opacity-40 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none w-full sm:w-auto">
                            <span id="analyzeBtnText">Select files to analyze</span>
                        </button>
                        <p id="loginHint" class="text-sm text-gray-500 mt-3 hidden">Log in to save your analysis history</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-24 px-6 lg:px-8 relative">
            <div class="max-w-6xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-3xl sm:text-4xl font-bold mb-4">Why <span class="text-electric">PermitPro</span>?</h2>
                    <p class="text-gray-400 max-w-xl mx-auto">Purpose-built for South Florida contractors who need fast, accurate permit compliance checks.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glow-border rounded-2xl p-8">
                        <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-electric/20 to-transparent border border-electric/30 flex items-center justify-center mb-6">
                            <svg class="w-7 h-7 text-electric" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">Instant Analysis</h3>
                        <p class="text-gray-400 leading-relaxed">Get comprehensive feedback on your entire permit package in seconds, not hours of manual review.</p>
                    </div>
                    <div class="glow-border rounded-2xl p-8">
                        <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-lime/20 to-transparent border border-lime/30 flex items-center justify-center mb-6">
                            <svg class="w-7 h-7 text-lime" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">City-Specific</h3>
                        <p class="text-gray-400 leading-relaxed">Requirements tailored to each South Florida municipality's specific codes and regulations.</p>
                    </div>
                    <div class="glow-border rounded-2xl p-8">
                        <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-coral/20 to-transparent border border-coral/30 flex items-center justify-center mb-6">
                            <svg class="w-7 h-7 text-coral" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">Track History</h3>
                        <p class="text-gray-400 leading-relaxed">Sign up to save all your analyses and track what changes were needed for each application.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-12 px-6 lg:px-8 border-t border-white/5">
            <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-3 mb-4 md:mb-0">
                    <div class="w-8 h-8 rounded-lg bg-electric/20 flex items-center justify-center">
                        <svg class="w-4 h-4 text-electric" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="font-semibold">PermitPro<span class="text-electric">AI</span></span>
                </div>
                <p class="text-gray-500 text-sm">© 2025 PermitPro AI. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- History Page -->
    <div id="historyPage" class="hidden pt-24 pb-12 px-6 lg:px-8 min-h-screen">
        <div class="max-w-6xl mx-auto">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-3xl font-bold mb-2">Analysis History</h1>
                    <p class="text-gray-400">View all your past permit analyses</p>
                </div>
                <button onclick="showPage('home'); document.getElementById('analyzer').scrollIntoView({behavior: 'smooth'})" class="btn-primary px-6 py-3 rounded-xl text-midnight font-semibold">
                    New Analysis
                </button>
            </div>
            
            <div id="historyLoading" class="text-center py-12">
                <div class="w-12 h-12 mx-auto border-2 border-electric/20 border-t-electric rounded-full animate-spin mb-4"></div>
                <p class="text-gray-400">Loading history...</p>
            </div>
            
            <div id="historyEmpty" class="hidden text-center py-12">
                <div class="w-20 h-20 mx-auto rounded-2xl bg-charcoal border border-white/10 flex items-center justify-center mb-6">
                    <svg class="w-10 h-10 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold mb-2">No analyses yet</h3>
                <p class="text-gray-500 mb-6">Start your first analysis to see it here</p>
                <button onclick="showPage('home'); document.getElementById('analyzer').scrollIntoView({behavior: 'smooth'})" class="btn-secondary px-6 py-3 rounded-xl text-electric">
                    Start Analysis
                </button>
            </div>
            
            <div id="historyList" class="hidden">
                <div class="glow-border rounded-2xl overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-charcoal/50">
                            <tr>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Date</th>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">City</th>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Permit Type</th>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Files</th>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Score</th>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Status</th>
                                <th class="text-left px-6 py-4 text-sm font-medium text-gray-400"></th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-midnight/95 backdrop-blur-xl z-50 flex items-center justify-center">
        <div class="text-center max-w-md w-full mx-6">
            <div class="w-24 h-24 mx-auto mb-8 relative">
                <div class="absolute inset-0 border-2 border-electric/20 rounded-full"></div>
                <div class="absolute inset-0 border-2 border-electric rounded-full border-t-transparent animate-spin"></div>
                <div class="absolute inset-4 border-2 border-lime/30 rounded-full border-b-transparent animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
            </div>
            <h3 class="text-2xl font-bold text-white mb-3">Analyzing Package</h3>
            <p id="loadingStatus" class="text-gray-400 mb-6">Uploading files...</p>
            <div class="w-full bg-charcoal rounded-full h-2 mb-4 overflow-hidden">
                <div id="progressBar" class="progress-bar h-2 rounded-full" style="width: 0%"></div>
            </div>
            <p id="currentFile" class="text-sm text-gray-500 font-mono truncate"></p>
        </div>
    </div>

    <!-- Results Section -->
    <section id="resultsSection" class="hidden py-24 px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
            <div class="glow-border rounded-3xl overflow-hidden">
                <div id="resultsHeader" class="p-8 border-b border-white/5"></div>
                <div id="filesAnalyzed" class="p-6 bg-obsidian/50 border-b border-white/5"></div>
                <div id="resultsContent" class="p-8"></div>
                <div class="p-6 bg-obsidian/50 border-t border-white/5 flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="newAnalysisBtn" class="btn-primary px-8 py-4 rounded-xl text-midnight font-semibold">New Analysis</button>
                    <button id="downloadBtn" class="btn-secondary px-8 py-4 rounded-xl text-electric font-medium">Download Report</button>
                </div>
            </div>
        </div>
    </section>
                        '<td class="px-6 py-4 text-sm text-white">' + a.city + '</td>' +
                        '<td class="px-6 py-4 text-sm text-gray-300">' + a.permit_type + '</td>' +
                        '<td class="px-6 py-4 text-sm text-gray-400">' + a.files_analyzed + ' files</td>' +
                        '<td class="px-6 py-4"><span class="font-mono font-bold ' + scoreColor + '">' + (a.compliance_score || '-') + '%</span></td>' +
                        '<td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-medium ' + statusClass + '">' + statusLabel + '</span></td>' +
                        '<td class="px-6 py-4"><button onclick="viewAnalysis(\'' + a.analysis_uuid + '\')" class="text-electric hover:underline text-sm">View</button></td>' +
                        '</tr>';
                }).join('');
            } catch (error) {
                loading.classList.add('hidden');
                empty.classList.remove('hidden');
                console.error('Error loading history:', error);
            }
        }

        async function viewAnalysis(uuid) {
            try {
                const response = await fetch(API_BASE_URL + '/api/history/' + uuid, {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });
                
                if (!response.ok) throw new Error('Failed to load analysis');
                
                const result = await response.json();
                displayResults({
                    analysis_id: result.analysis_uuid,
                    city: result.city,
                    permit_type: result.permit_type,
                    files_analyzed: result.files_analyzed,
                    file_tree: result.file_list,
                    analysis: result.analysis
                });
                
                document.getElementById('historyPage').classList.add('hidden');
            } catch (error) {
                alert('Error loading analysis: ' + error.message);
            }
        }

        // File handling functions
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function getFileExtension(filename) {
            return '.' + filename.split('.').pop().toLowerCase();
        }

        function isValidFileType(filename) {
            return ALLOWED_EXTENSIONS.includes(getFileExtension(filename));
        }

        function validateFiles(files) {
            validFiles = [];
            invalidFiles = [];
            var totalBytes = 0;
            
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                if (!isValidFileType(file.name)) {
                    invalidFiles.push({ name: file.name, reason: 'Invalid type' });
                    continue;
                }
                if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) {
                    invalidFiles.push({ name: file.name, reason: 'Too large' });
                    continue;
                }
                if (validFiles.length >= MAX_FILES) {
                    invalidFiles.push({ name: file.name, reason: 'Exceeds limit' });
                    continue;
                }
                validFiles.push(file);
                totalBytes += file.size;
            }
            return { validFiles: validFiles, invalidFiles: invalidFiles, totalBytes: totalBytes };
        }

        function updateFilePreview() {
            var result = validateFiles(selectedFiles);
            var totalBytes = result.totalBytes;
            
            if (validFiles.length === 0 && invalidFiles.length === 0) {
                document.getElementById('filePreview').classList.add('hidden');
                updateAnalyzeButton();
                return;
            }
            
            document.getElementById('filePreview').classList.remove('hidden');
            document.getElementById('fileCount').textContent = selectedFiles.length;
            document.getElementById('totalSize').textContent = formatFileSize(totalBytes);
            document.getElementById('validCount').textContent = validFiles.length;
            
            var sizePercentage = (totalBytes / (MAX_TOTAL_SIZE_MB * 1024 * 1024)) * 100;
            var sizeWarning = document.getElementById('sizeWarning');
            
            if (sizePercentage > 100) {
                sizeWarning.classList.remove('hidden');
                sizeWarning.className = 'mb-4 p-4 rounded-xl flex items-center bg-coral/10 border border-coral/30 text-coral';
                sizeWarning.innerHTML = '<svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>Total size exceeds ' + MAX_TOTAL_SIZE_MB + 'MB limit';
            } else if (sizePercentage > 80) {
                sizeWarning.classList.remove('hidden');
                sizeWarning.className = 'mb-4 p-4 rounded-xl flex items-center bg-yellow-500/10 border border-yellow-500/30 text-yellow-500';
                sizeWarning.innerHTML = '<svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>Approaching limit (' + sizePercentage.toFixed(0) + '% used)';
            } else {
                sizeWarning.classList.add('hidden');
            }
            
            var invalidWarning = document.getElementById('invalidFilesWarning');
            if (invalidFiles.length > 0) {
                invalidWarning.classList.remove('hidden');
                document.getElementById('invalidFilesList').innerHTML = invalidFiles.map(function(f) { return '<li>' + f.name + ': ' + f.reason + '</li>'; }).join('');
            } else {
                invalidWarning.classList.add('hidden');
            }
            
            document.getElementById('fileList').innerHTML = validFiles.map(function(file) {
                return '<li class="file-item flex items-center justify-between px-4 py-3"><div class="flex items-center min-w-0"><svg class="w-4 h-4 text-electric/50 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg><span class="truncate text-gray-300 text-sm">' + file.name + '</span></div><span class="text-xs text-gray-500 ml-4 font-mono">' + formatFileSize(file.size) + '</span></li>';
            }).join('');
            
            updateAnalyzeButton();
        }

        function updateAnalyzeButton() {
            var city = document.getElementById('citySelect').value;
            var permit = document.getElementById('permitSelect').value;
            var hasValidFiles = validFiles.length > 0;
            var totalBytes = validFiles.reduce(function(sum, f) { return sum + f.size; }, 0);
            var underSizeLimit = totalBytes <= MAX_TOTAL_SIZE_MB * 1024 * 1024;
            var canAnalyze = city && permit && hasValidFiles && underSizeLimit;
            
            var btn = document.getElementById('analyzeBtn');
            var btnText = document.getElementById('analyzeBtnText');
            btn.disabled = !canAnalyze;
            
            if (!city || !permit) {
                btnText.textContent = 'Select city and permit type';
            } else if (!hasValidFiles) {
                btnText.textContent = 'Select files to analyze';
            } else if (!underSizeLimit) {
                btnText.textContent = 'Files exceed size limit';
            } else {
                btnText.textContent = 'Analyze ' + validFiles.length + ' file' + (validFiles.length > 1 ? 's' : '') + ' (' + formatFileSize(totalBytes) + ')';
            }
        }

        function clearFiles() {
            selectedFiles = [];
            validFiles = [];
            invalidFiles = [];
            document.getElementById('folderInput').value = '';
            document.getElementById('filePreview').classList.add('hidden');
            updateAnalyzeButton();
        }

        // Event Listeners
        document.getElementById('selectFolderBtn').addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('folderInput').click();
        });

        document.getElementById('dropZone').addEventListener('click', function() {
            document.getElementById('folderInput').click();
        });

        document.getElementById('folderInput').addEventListener('change', function(e) {
            selectedFiles = Array.from(e.target.files);
            updateFilePreview();
        });

        document.getElementById('dropZone').addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drop-zone-active');
        });

        document.getElementById('dropZone').addEventListener('dragleave', function() {
            this.classList.remove('drop-zone-active');
        });

        document.getElementById('dropZone').addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drop-zone-active');
            var filesArray = [];
            for (var i = 0; i < e.dataTransfer.items.length; i++) {
                if (e.dataTransfer.items[i].kind === 'file') {
                    var file = e.dataTransfer.items[i].getAsFile();
                    if (file) filesArray.push(file);
                }
            }
            if (filesArray.length > 0) {
                selectedFiles = filesArray;
                updateFilePreview();
            }
        });

        document.getElementById('clearFilesBtn').addEventListener('click', clearFiles);
        document.getElementById('citySelect').addEventListener('change', updateAnalyzeButton);
        document.getElementById('permitSelect').addEventListener('change', updateAnalyzeButton);

        document.getElementById('analyzeBtn').addEventListener('click', async function() {
            var city = document.getElementById('citySelect').value;
            var permit = document.getElementById('permitSelect').value;
            
            if (!city || !permit || validFiles.length === 0) {
                alert('Please select city, permit type, and upload files.');
                return;
            }
            
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('loadingStatus').textContent = 'Preparing upload...';
            document.getElementById('currentFile').textContent = '';
            
            try {
                var formData = new FormData();
                formData.append('city', city);
                formData.append('permit_type', permit);
                
                for (var i = 0; i < validFiles.length; i++) {
                    formData.append('files', validFiles[i]);
                    document.getElementById('progressBar').style.width = ((i + 1) / validFiles.length * 50) + '%';
                    document.getElementById('currentFile').textContent = validFiles[i].name;
                }
                
                document.getElementById('loadingStatus').textContent = 'Uploading files...';
                document.getElementById('progressBar').style.width = '50%';
                
                var headers = {};
                if (authToken) {
                    headers['Authorization'] = 'Bearer ' + authToken;
                }
                
                var response = await fetch(API_BASE_URL + '/api/analyze-permit-folder', {
                    method: 'POST',
                    headers: headers,
                    body: formData
                });
                
                document.getElementById('progressBar').style.width = '80%';
                document.getElementById('loadingStatus').textContent = 'AI analyzing documents...';
                
                if (!response.ok) {
                    var errorData = await response.json().catch(function() { return {}; });
                    throw new Error(errorData.detail || 'Server error: ' + response.status);
                }
                
                var result = await response.json();
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('loadingStatus').textContent = 'Analysis complete!';
                
                await new Promise(function(resolve) { setTimeout(resolve, 500); });
                displayResults(result);
                
            } catch (error) {
                console.error('Analysis error:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
                alert('Analysis failed: ' + error.message);
            }
        });

        function displayResults(result) {
            document.getElementById('loadingOverlay').classList.add('hidden');
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('historyPage').classList.add('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            
            var analysis = result.analysis || {};
            var status = analysis.overall_status || 'UNKNOWN';
            var score = analysis.compliance_score || 0;
            
            var statusClasses = { 'READY': 'status-ready', 'NEEDS_ATTENTION': 'status-attention', 'INCOMPLETE': 'status-incomplete', 'ERROR': 'status-incomplete', 'NEEDS_REVIEW': 'status-attention' };
            var statusLabels = { 'READY': 'Ready to Submit', 'NEEDS_ATTENTION': 'Needs Attention', 'INCOMPLETE': 'Incomplete', 'ERROR': 'Error', 'NEEDS_REVIEW': 'Needs Review' };
            var scoreColor = score >= 70 ? 'text-lime' : (score >= 40 ? 'text-yellow-500' : 'text-coral');
            
            document.getElementById('resultsHeader').innerHTML = '<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6"><div><h3 class="text-2xl font-bold text-white mb-1">Analysis Complete</h3><p class="text-gray-400">' + result.city + ' - ' + result.permit_type + '</p></div><div class="flex items-center gap-4"><span class="px-4 py-2 rounded-lg text-sm font-semibold ' + (statusClasses[status] || 'status-attention') + '">' + (statusLabels[status] || status) + '</span><div class="text-center"><div class="text-3xl font-bold font-mono ' + scoreColor + '">' + score + '%</div><div class="text-xs text-gray-500">Compliance</div></div></div></div>';
            
            if (result.file_tree && result.file_tree.length > 0) {
                var fileTreeHtml = '<h4 class="font-semibold text-white mb-3">Files Analyzed: ' + result.files_analyzed + '</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-2">';
                for (var i = 0; i < result.file_tree.length; i++) {
                    var f = result.file_tree[i];
                    fileTreeHtml += '<div class="flex items-center text-sm text-gray-400 bg-charcoal/50 rounded-lg px-3 py-2"><span class="text-electric/50 mr-2 font-mono">|--</span><span class="truncate flex-1">' + f.name + '</span><span class="text-gray-600 ml-2 font-mono text-xs">' + f.size + '</span></div>';
                }
                fileTreeHtml += '</div>';
                document.getElementById('filesAnalyzed').innerHTML = fileTreeHtml;
            } else {
                document.getElementById('filesAnalyzed').innerHTML = '';
            }
            
            var contentHTML = '';
            
            if (analysis.summary) {
                contentHTML += '<div class="mb-8"><h4 class="text-lg font-semibold text-white mb-3">Summary</h4><p class="text-gray-400 leading-relaxed">' + analysis.summary + '</p></div>';
            }
            
            if (analysis.critical_issues && analysis.critical_issues.length > 0) {
                contentHTML += '<div class="mb-8"><h4 class="text-lg font-semibold text-coral mb-4">Critical Issues</h4><ul class="space-y-2">';
                for (var i = 0; i < analysis.critical_issues.length; i++) {
                    contentHTML += '<li class="flex items-start text-coral/90 text-sm"><span class="mr-3 text-coral">•</span><span>' + analysis.critical_issues[i] + '</span></li>';
                }
                contentHTML += '</ul></div>';
            }
            
            if (analysis.missing_documents && analysis.missing_documents.length > 0) {
                contentHTML += '<div class="mb-8"><h4 class="text-lg font-semibold text-yellow-500 mb-4">Missing Documents</h4><ul class="space-y-2">';
                for (var i = 0; i < analysis.missing_documents.length; i++) {
                    contentHTML += '<li class="flex items-start text-yellow-500/90 text-sm"><span class="mr-3 text-yellow-500">•</span><span>' + analysis.missing_documents[i] + '</span></li>';
                }
                contentHTML += '</ul></div>';
            }
            
            if (analysis.recommendations && analysis.recommendations.length > 0) {
                contentHTML += '<div class="mb-8"><h4 class="text-lg font-semibold text-electric mb-4">Recommendations</h4><ul class="space-y-2">';
                for (var i = 0; i < analysis.recommendations.length; i++) {
                    contentHTML += '<li class="flex items-start text-gray-400 text-sm"><span class="mr-3 text-electric">•</span><span>' + analysis.recommendations[i] + '</span></li>';
                }
                contentHTML += '</ul></div>';
            }
            
            if (analysis.next_steps && analysis.next_steps.length > 0) {
                contentHTML += '<div class="mb-4"><h4 class="text-lg font-semibold text-lime mb-4">Next Steps</h4><ol class="space-y-2 list-decimal list-inside">';
                for (var i = 0; i < analysis.next_steps.length; i++) {
                    contentHTML += '<li class="text-gray-400 text-sm">' + analysis.next_steps[i] + '</li>';
                }
                contentHTML += '</ol></div>';
            }
            
            document.getElementById('resultsContent').innerHTML = contentHTML || '<p class="text-gray-500 text-center py-8">No detailed analysis available.</p>';
        }

        document.getElementById('newAnalysisBtn').addEventListener('click', function() {
            clearFiles();
            document.getElementById('resultsSection').classList.add('hidden');
            showPage('home');
            setTimeout(function() {
                document.getElementById('analyzer').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        });
    </script>
</body>
</html>